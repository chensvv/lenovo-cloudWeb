!function(I){"use strict";var d=function(){},U=function(e){return new t(e)};U.LM="2023-06-17 20:03";var x="Recorder",C="getUserMedia",P="srcSampleRate",W="sampleRate",A="catch";U.IsOpen=function(){var e=U.Stream;if(e){var t=e.getTracks&&e.getTracks()||e.audioTracks||[],r=t[0];if(r){var n=r.readyState;return"live"==n||n==r.LIVE}}return!1},U.BufferSize=4096,U.Destroy=function(){for(var e in F(x+" Destroy"),S(),r)r[e]()};var r={};U.BindDestroy=function(e,t){r[e]=t},U.Support=function(){var e=navigator.mediaDevices||{};return e[C]||(e=navigator)[C]||(e[C]=e.webkitGetUserMedia||e.mozGetUserMedia||e.msGetUserMedia),!!e[C]&&(U.Scope=e,!!U.GetContext())},U.GetContext=function(){var e=I.AudioContext;return e||(e=I.webkitAudioContext),e?(U.Ctx&&"closed"!=U.Ctx.state||(U.Ctx=new e,U.BindDestroy("Ctx",function(){var e=U.Ctx;e&&e.close&&(e.close(),U.Ctx=0)})),U.Ctx):null};var L="ConnectEnableWebM";U[L]=!0;var T="ConnectEnableWorklet";U[T]=!1;var y=function(e,f){var c,r,u,l=e.BufferSize||U.BufferSize,v=U.Ctx,p=e.Stream,i=function(e){var t=p._m=v.createMediaStreamSource(p);t.connect(e),e.connect(v.destination)},h="",g=p._call,m=function(e){for(var t in g){for(var r=e.length,n=new Int16Array(r),a=0,o=0;o<r;o++){var i=Math.max(-1,Math.min(1,e[o]));i=i<0?32768*i:32767*i,n[o]=i,a+=Math.abs(i)}for(var s in g)g[s](n,a);return}},d="ScriptProcessor",C="audioWorklet",s=x+" "+C,y="RecProc",S="MediaRecorder",_=S+".WebM.PCM",b=v.createScriptProcessor||v.createJavaScriptNode,k="。由于"+C+"内部1秒375次回调，在移动端可能会有性能问题导致回调丢失录音变短，PC端无影响，暂不建议开启"+C+"。",M=function(){r=p.isWorklet=!1,R(p),F("Connect采用老的"+d+"，"+(U[T]?"但已":"可")+"设置"+x+"."+T+"=true尝试启用"+C+h+k,3);var e=p._p=b.call(v,l,1,1);i(e),e.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0);m(t)}},w=function(){c=p.isWebM=!1,D(p),r=p.isWorklet=!b||U[T];var t=I.AudioWorkletNode;if(r&&v[C]&&t){var n=function(){return r&&p._na},a=p._na=function(){""!==u&&(clearTimeout(u),u=setTimeout(function(){u=0,n()&&(F(C+"未返回任何音频，恢复使用"+d,3),b&&M())},500))},o=function(){if(n()){var e=p._n=new t(v,y,{processorOptions:{bufferSize:l}});i(e),e.port.onmessage=function(e){u&&(clearTimeout(u),u=""),n()?m(e.data.val):r||F(C+"多余回调",3)},F("Connect采用"+C+"，设置"+x+"."+T+"=false可恢复老式"+d+h+k,3)}};v.resume()[g&&"finally"](function(){if(n())if(v[y])o();else{var e,t,r=(t="class "+y+" extends AudioWorkletProcessor{",t+="constructor "+(e=function(e){return e.toString().replace(/^function|DEL_/g,"").replace(/\$RA/g,s)})(function(e){DEL_super(e);var t=this,r=e.processorOptions.bufferSize;t.bufferSize=r,t.buffer=new Float32Array(2*r),t.pos=0,t.port.onmessage=function(e){e.data.kill&&(t.kill=!0,$C.log("$RA kill call"))},$C.log("$RA .ctor call",e)}),t+="process "+e(function(e,t,r){var n=this,a=n.bufferSize,o=n.buffer,i=n.pos;if((e=(e[0]||[])[0]||[]).length){o.set(e,i);var s=~~((i+=e.length)/a)*a;if(s){this.port.postMessage({val:o.slice(0,s)});var f=o.subarray(s,i);(o=new Float32Array(2*a)).set(f),i=f.length,n.buffer=o}n.pos=i}return!n.kill}),t=(t+='}try{registerProcessor("'+y+'", '+y+')}catch(e){$C.error("'+s+'注册失败",e)}').replace(/\$C\./g,"console."),"data:text/javascript;base64,"+btoa(unescape(encodeURIComponent(t))));v[C].addModule(r).then(function(e){n()&&(v[y]=1,o(),u&&a())})[A](function(e){F(C+".addModule失败",1,e),n()&&M()})}})}else M()};!function(){var e=I[S],t="ondataavailable",r="audio/webm; codecs=pcm";c=p.isWebM=U[L];var n=e&&t in e.prototype&&e.isTypeSupported(r);if(h=n?"":"（此浏览器不支持"+_+"）",!f||!c||!n)return w();var a=function(){return c&&p._ra},o=(p._ra=function(){""!==u&&(clearTimeout(u),u=setTimeout(function(){a()&&(F(S+"未返回任何音频，降级使用"+C,3),w())},500))},Object.assign({mimeType:r},U.ConnectWebMOptions)),i=p._r=new e(p,o),s=p._rd={sampleRate:v[W]};i[t]=function(e){var t=new FileReader;t.onloadend=function(){if(a()){var e=O(new Uint8Array(t.result),s);if(!e)return;if(-1==e)return void w();u&&(clearTimeout(u),u=""),m(e)}else c||F(S+"多余回调",3)},t.readAsArrayBuffer(e.data)},i.start(~~(l/48)),F("Connect采用"+_+"，设置"+x+"."+L+"=false可恢复使用"+C+"或老式"+d)}()},R=function(e){e._na=null,e._n&&(e._n.port.postMessage({kill:!0}),e._n.disconnect(),e._n=null)},D=function(e){e._ra=null,e._r&&(e._r.stop(),e._r=null)},S=function(e){var t=(e=e||U)==U,r=e.Stream;if(r&&(r._m&&(r._m.disconnect(),r._m=null),r._p&&(r._p.disconnect(),r._p.onaudioprocess=r._p=null),R(r),D(r),t)){for(var n=r.getTracks&&r.getTracks()||r.audioTracks||[],a=0;a<n.length;a++){var o=n[a];o.stop&&o.stop()}r.stop&&r.stop()}e.Stream=0};U.SampleData=function(e,t,r,n,a){var o="SampleData";n||(n={});var i=n.index||0,s=n.offset||0,f=n.filter;if(f&&f.fn&&f.sr!=t&&(f=null,F(o+"的filter采样率变了，重设滤波",3)),!f){var c=3*t/4<r?0:r/2*3/4;f={fn:c?U.IIRFilter(!0,t,c):0}}f.sr=t;var u=f.fn,l=n.frameNext||[];a||(a={});var v=a.frameSize||1;a.frameType&&(v="mp3"==a.frameType?1152:1);var p=e.length;p+1<i&&F(o+"似乎传入了未重置chunk "+i+">"+p,3);for(var h=0,g=i;g<p;g++)h+=e[g].length;h=Math.max(0,h-Math.floor(s));var m=t/r;1<m?h=Math.floor(h/m):(m=1,r=t),h+=l.length;for(var d=new Int16Array(h),C=0,g=0;g<l.length;g++)d[C]=l[g],C++;for(;i<p;i++){for(var y=e[i],g=s,S=y.length,_=new Int16Array(S),b=0,k=1;b<S;b++,k++){0==b&&(_[0]=u?u(y[0]):y[0]),k<S&&(_[k]=u?u(y[k]):y[k]);var M=Math.floor(g);if(b==M){var w=Math.ceil(g),I=g-M,x=_[M],A=w<S?_[w]:x;d[C]=x+(A-x)*I,C++,g+=m}}s=Math.max(0,g-S)}l=null;var L=d.length%v;if(0<L){var T=2*(d.length-L);l=new Int16Array(d.buffer.slice(T)),d=new Int16Array(d.buffer.slice(0,T))}return{index:i,offset:s,filter:f,frameNext:l,sampleRate:r,data:d}},U.IIRFilter=function(e,t,r){var n=2*Math.PI*r/t,a=Math.sin(n),o=Math.cos(n),i=a/2,s=1+i,f=-2*o/s,c=(1-i)/s;if(e)var u=(1-o)/2/s,l=(1-o)/s;else var u=(1+o)/2/s,l=-(1+o)/s;var v=0,p=0,h=0,g=0,m=0;return function(e){return h=u*e+l*v+u*p-f*g-c*m,p=v,v=e,m=g,g=h}},U.PowerLevel=function(e,t){var r=e/t||0;return r<1251?Math.round(r/1250*10):Math.round(Math.min(100,Math.max(0,100*(1+Math.log(r/1e4)/Math.log(10)))))},U.PowerDBFS=function(e){var t=Math.max(.1,e||0);return t=Math.min(t,32767),t=20*Math.log(t/32767)/Math.log(10),Math.max(-100,Math.round(t))},U.CLog=function(e,t){var r=new Date,n=("0"+r.getMinutes()).substr(-2)+":"+("0"+r.getSeconds()).substr(-2)+"."+("00"+r.getMilliseconds()).substr(-3),a=this&&this.envIn&&this.envCheck&&this.id,o=["["+n+" "+x+(a?":"+a:"")+"]"+e],i=arguments,s=I.console||{},f=2,c=s.log;for("number"==typeof t?c=1==t?s.error:3==t?s.warn:c:f=1;f<i.length;f++)o.push(i[f]);u?c&&c("[IsLoser]"+o[0],1<o.length?o:""):c.apply(s,o)};var F=function(){U.CLog.apply(this,arguments)},u=!0;try{u=!console.log.apply}catch(e){}var n=0;function t(e){this.id=++n,o();var t={type:"mp3",bitRate:16,sampleRate:16e3,onProcess:d};for(var r in e)t[r]=e[r];this.set=t,this._S=9,this.Sync={O:9,C:9}}U.Sync={O:9,C:9},U.prototype=t.prototype={CLog:F,_streamStore:function(){return this.set.sourceStream?this:U},open:function(e,r){var n=this,t=n.set,a=n._streamStore();e=e||d;var o=function(e,t){t=!!t,n.CLog("录音open失败："+e+",isUserNotAllow:"+t,1),r&&r(e,t)},i=function(){n.CLog("open ok id:"+n.id),e(),n._SO=0},s=a.Sync,f=++s.O,c=s.C;n._O=n._O_=f,n._SO=n._S;var u=n.envCheck({envName:"H5",canProcess:!0});if(u)o("不能录音："+u);else if(t.sourceStream){if(!U.GetContext())return void o("不支持此浏览器从流中获取录音");S(a),n.Stream=t.sourceStream,n.Stream._call={};try{y(a)}catch(e){return void o("从流中打开录音失败："+e.message)}i()}else{var l=function(e,t){try{I.top.a}catch(e){return void o('无权录音(跨域，请尝试给iframe添加麦克风访问策略，如allow="camera;microphone")')}/Permission|Allow/i.test(e)?o("用户拒绝了录音权限",!0):!1===I.isSecureContext?o("浏览器禁止不安全页面录音，可开启https解决"):/Found/i.test(e)?o(t+"，无可用麦克风"):o(t)};if(U.IsOpen())i();else if(U.Support()){var v=function(t){setTimeout(function(){t._call={};var e=U.Stream;e&&(S(),t._call=e._call),U.Stream=t,function(){if(c!=s.C||!n._O){var e="open被取消";return f==s.O?n.close():e="open被中断",o(e),!0}}()||(U.IsOpen()?(e&&n.CLog("发现同时多次调用open",1),y(a,1),i()):o("录音功能无效：无音频流"))},100)},p=function(e){var t=e.name||e.message||e.code+":"+e;n.CLog("请求录音权限错误",1,e),l(t,"无法录音："+t)},h=t.audioTrackSet||{};h.sampleRate=U.Ctx.sampleRate;var g={audio:h};try{var m=U.Scope[C](g,v,p)}catch(e){n.CLog(C,3,e),g={audio:!0},m=U.Scope[C](g,v,p)}n.CLog(C+"("+JSON.stringify(g)+")，一般默认会降噪和回声消除，移动端可能会降低系统播放音量，请参阅文档中audioTrackSet配置"),m&&m.then&&m.then(v)[A](p)}else l("","此浏览器不支持录音")}},close:function(e){e=e||d;var t=this,r=t._streamStore();t._stop();var n=r.Sync;if(t._O=0,t._O_!=n.O)return t.CLog("close被忽略（因为同时open了多个rec，只有最后一个会真正close）",3),void e();n.C++,S(r),t.CLog("close"),e()},mock:function(e,t){var r=this;return r._stop(),r.isMock=1,r.mockEnvInfo=null,r.buffers=[e],r.recSize=e.length,r[P]=t,r},envCheck:function(e){var t,r=this.set,n="CPU_BE";if(t||U[n]||!I.Int8Array||new Int8Array(new Int32Array([1]).buffer)[0]||(o(n),t="不支持CPU_BE架构"),!t){var a=r.type;this[a+"_envCheck"]?t=this[a+"_envCheck"](e,r):r.takeoffEncodeChunk&&(t=a+"类型"+(this[a]?"":"(未加载编码器)")+"不支持设置takeoffEncodeChunk")}return t||""},envStart:function(e,t){var r=this,n=r.set;r.isMock=e?1:0,r.mockEnvInfo=e,r.buffers=[],r.recSize=0,r.envInLast=0,r.envInFirst=0,r.envInFix=0,r.envInFixTs=[];var a=n[W];if(t<a?n[W]=t:a=0,r[P]=t,r.CLog(P+": "+t+" set."+W+": "+n[W]+(a?" 忽略"+a:""),a?3:0),r.engineCtx=0,r[n.type+"_start"]){var o=r.engineCtx=r[n.type+"_start"](n);o&&(o.pcmDatas=[],o.pcmSize=0)}},envResume:function(){this.envInFixTs=[]},envIn:function(e,t){var a=this,o=a.set,i=a.engineCtx,r=a[P],n=e.length,s=U.PowerLevel(t,n),f=a.buffers,c=f.length;f.push(e);var u=f,l=c,v=Date.now(),p=Math.round(n/r*1e3);a.envInLast=v,1==a.buffers.length&&(a.envInFirst=v-p);var h=a.envInFixTs;h.splice(0,0,{t:v,d:p});for(var g=v,m=0,d=0;d<h.length;d++){var C=h[d];if(3e3<v-C.t){h.length=d;break}g=C.t,m+=C.d}var y=h[1],S=v-g;if(S/3<S-m&&(y&&1e3<S||6<=h.length)){var _=v-y.t-p;if(p/5<_){var b=!o.disableEnvInFix;if(a.CLog("["+v+"]"+(b?"":"未")+"补偿"+_+"ms",3),a.envInFix+=_,b){var k=new Int16Array(_*r/1e3);n+=k.length,f.push(k)}}}var M=a.recSize,w=n,I=M+w;if(a.recSize=I,i){var x=U.SampleData(f,r,o[W],i.chunkInfo);i.chunkInfo=x,I=(M=i.pcmSize)+(w=x.data.length),i.pcmSize=I,f=i.pcmDatas,c=f.length,f.push(x.data),r=x[W]}var A=Math.round(I/r*1e3),L=f.length,T=u.length,R=function(){for(var e=D?0:-w,t=null==f[0],r=c;r<L;r++){var n=f[r];null==n?t=1:(e+=n.length,i&&n.length&&a[o.type+"_encode"](i,n))}if(t&&i)for(r=l,u[0]&&(r=0);r<T;r++)u[r]=null;t&&(e=D?w:0,f[0]=null),i?i.pcmSize+=e:a.recSize+=e},D=0,F="rec.set.onProcess";try{D=o.onProcess(f,s,A,r,c,R)}catch(e){console.error(F+"回调出错是不允许的，需保证不会抛异常",e)}var O=Date.now()-v;if(10<O&&1e3<a.envInFirst-v&&a.CLog(F+"低性能，耗时"+O+"ms",3),!0===D){var z=0;for(d=c;d<L;d++)null==f[d]?z=1:f[d]=new Int16Array(0);z?a.CLog("未进入异步前不能清除buffers",3):i?i.pcmSize-=w:a.recSize-=w}else R()},start:function(){var t=this,r=U.Ctx,e=1;if(t.set.sourceStream?t.Stream||(e=0):U.IsOpen()||(e=0),e)if(t.CLog("开始录音"),t._stop(),t.state=3,t.envStart(null,r[W]),t._SO&&t._SO+1!=t._S)t.CLog("start被中断",3);else{t._SO=0;var n=function(){3==t.state&&(t.state=1,t.resume())};if("suspended"==r.state){var a="AudioContext resume: ";t.CLog(a+"wait..."),r.resume().then(function(){t.CLog(a+r.state),n()})[A](function(e){t.CLog(a+r.state+" 可能无法录音："+e.message,1,e),n()})}else n()}else t.CLog("未open",1)},pause:function(){var e=this;e.state&&(e.state=2,e.CLog("pause"),delete e._streamStore().Stream._call[e.id])},resume:function(){var e,r=this;if(r.state){r.state=1,r.CLog("resume"),r.envResume();var t=r._streamStore().Stream;t._call[r.id]=function(e,t){1==r.state&&r.envIn(e,t)},(e=t)._na&&e._na(),e._ra&&e._ra()}},_stop:function(e){var t=this,r=t.set;t.isMock||t._S++,t.state&&(t.pause(),t.state=0),!e&&t[r.type+"_stop"]&&(t[r.type+"_stop"](t.engineCtx),t.engineCtx=0)},stop:function(r,t,e){var n,a=this,o=a.set,i=a.envInLast-a.envInFirst,s=i&&a.buffers.length;a.CLog("stop 和start时差"+(i?i+"ms 补偿"+a.envInFix+"ms envIn:"+s+" fps:"+(s/i*1e3).toFixed(1):"-"));var f=function(){a._stop(),e&&a.close()},c=function(e){a.CLog("结束录音失败："+e,1),t&&t(e),f()},u=function(e,t){if(a.CLog("结束录音 编码花"+(Date.now()-n)+"ms 音频时长"+t+"ms 文件大小"+e.size+"b"),o.takeoffEncodeChunk)a.CLog("启用takeoffEncodeChunk后stop返回的blob长度为0不提供音频数据",3);else if(e.size<Math.max(100,t/2))return void c("生成的"+o.type+"无效");r&&r(e,t),f()};if(!a.isMock){var l=3==a.state;if(!a.state||l)return void c("未开始录音"+(l?"，开始录音前无用户交互导致AudioContext未运行":""));a._stop(!0)}var v=a.recSize;if(v)if(a.buffers[0])if(a[o.type]){if(a.isMock){var p=a.envCheck(a.mockEnvInfo||{envName:"mock",canProcess:!1});if(p)return void c("录音错误："+p)}var h=a.engineCtx;if(a[o.type+"_complete"]&&h){var g=Math.round(h.pcmSize/o[W]*1e3);return n=Date.now(),void a[o.type+"_complete"](h,function(e){u(e,g)},c)}n=Date.now();var m=U.SampleData(a.buffers,a[P],o[W]);o[W]=m[W];var d=m.data;g=Math.round(d.length/o[W]*1e3),a.CLog("采样"+v+"->"+d.length+" 花:"+(Date.now()-n)+"ms"),setTimeout(function(){n=Date.now(),a[o.type](d,function(e){u(e,g)},function(e){c(e)})})}else c("未加载"+o.type+"编码器");else c("音频buffers被释放");else c("未采集到录音")}},I[x]&&(F("重复引入"+x,3),I[x].Destroy()),I[x]=U;var O=function(e,t){t.pos||(t.pos=[0],t.tracks={},t.bytes=[]);var r=t.tracks,n=[t.pos[0]],a=function(){t.pos[0]=n[0]},o=t.bytes.length,i=new Uint8Array(o+e.length);if(i.set(t.bytes),i.set(e,o),t.bytes=i,!t._ht){if(B(i,n),N(i,n),!z(B(i,n),[24,83,128,103]))return;for(B(i,n);n[0]<i.length;){var s=B(i,n),f=N(i,n),c=[0],u=0;if(!f)return;if(z(s,[22,84,174,107])){for(;c[0]<f.length;){var l=B(f,c),v=N(f,c),p=[0],h={channels:0,sampleRate:0};if(z(l,[174]))for(;p[0]<v.length;){var g=B(v,p),m=N(v,p),d=[0];if(z(g,[215])){var C=E(m);h.number=C,r[C]=h}else if(z(g,[131])){var C=E(m);1==C?h.type="video":2==C?(h.type="audio",u||(t.track0=h),h.idx=u++):h.type="Type-"+C}else if(z(g,[134])){for(var y="",S=0;S<m.length;S++)y+=String.fromCharCode(m[S]);h.codec=y}else if(z(g,[225]))for(;d[0]<m.length;){var _=B(m,d),b=N(m,d);if(z(_,[181])){var C=0,k=new Uint8Array(b.reverse()).buffer;4==b.length?C=new Float32Array(k)[0]:8==b.length?C=new Float64Array(k)[0]:F("WebM Track !Float",1,b),h[W]=Math.round(C)}else z(_,[98,100])?h.bitDepth=E(b):z(_,[159])&&(h.channels=E(b))}}}t._ht=1,F("WebM Tracks",r),a();break}}}var M=t.track0;if(M){if(16==M.bitDepth&&/FLOAT/i.test(M.codec)&&(M.bitDepth=32,F("WebM 16改32位",3)),M[W]!=t[W]||32!=M.bitDepth||M.channels<1||!/(\b|_)PCM\b/i.test(M.codec))return t.bytes=[],t.bad||F("WebM Track非预期",3,t),-(t.bad=1);for(var w=[],I=0;n[0]<i.length;){var l=B(i,n),v=N(i,n);if(!v)break;if(z(l,[163])){var x=15&v[0],h=r[x];if(h){if(0===h.idx){for(var A=new Uint8Array(v.length-4),S=4;S<v.length;S++)A[S-4]=v[S];w.push(A),I+=A.length}}else F("WebM !Track"+x,1,r)}a()}if(I){var L=new Uint8Array(i.length-t.pos[0]);L.set(i.subarray(t.pos[0])),t.bytes=L,t.pos[0]=0;for(var A=new Uint8Array(I),S=0,T=0;S<w.length;S++)A.set(w[S],T),T+=w[S].length;var k=new Float32Array(A.buffer);if(1<M.channels){for(var R=[],S=0;S<k.length;)R.push(k[S]),S+=M.channels;k=new Float32Array(R)}return k}}},z=function(e,t){if(!e||e.length!=t.length)return!1;if(1==e.length)return e[0]==t[0];for(var r=0;r<e.length;r++)if(e[r]!=t[r])return!1;return!0},E=function(e){for(var t="",r=0;r<e.length;r++){var n=e[r];t+=(n<16?"0":"")+n.toString(16)}return parseInt(t,16)||0},B=function(e,t,r){var n=t[0];if(!(n>=e.length)){var a=e[n],o=("0000000"+a.toString(2)).substr(-8),i=/^(0*1)(\d*)$/.exec(o);if(i){var s=i[1].length,f=[];if(!(n+s>e.length)){for(var c=0;c<s;c++)f[c]=e[n],n++;return r&&(f[0]=parseInt(i[2]||"0",2)),t[0]=n,f}}}},N=function(e,t){var r=B(e,t,1);if(r){var n=E(r),a=t[0],o=[];if(n<2147483647){if(a+n>e.length)return;for(var i=0;i<n;i++)o[i]=e[a],a++}return t[0]=a,o}};U.TrafficImgUrl="//ia.51.la/go1?id=20469973&pvFlag=1";var o=U.Traffic=function(e){e=e?"/"+x+"/Report/"+e:"";var t=U.TrafficImgUrl;if(t){var r=U.Traffic,n=/^(https?:..[^\/#]*\/?)[^#]*/i.exec(location.href)||[],a=n[1]||"http://file/",o=(n[0]||a)+e;if(0==t.indexOf("//")&&(t=/^https:/i.test(o)?"https:"+t:"http:"+t),e&&(t=t+"&cu="+encodeURIComponent(a+e)),!r[o]){r[o]=1;var i=new Image;i.src=t,F("Traffic Analysis Image: "+(e||x+".TrafficImgUrl="+U.TrafficImgUrl))}}}}(window),"function"==typeof define&&define.amd&&define(function(){return Recorder}),"object"==typeof module&&module.exports&&(module.exports=Recorder),function(){"use strict";Recorder.prototype.enc_wav={stable:!0,fast:!0,testmsg:"支持位数8位、16位（填在比特率里面），采样率取值无限制；此编码器仅在pcm数据前加了一个44字节的wav头，编码出来的16位wav文件去掉开头的44字节即可得到pcm（注：其他wav编码器可能不是44字节）"},Recorder.prototype.wav=function(e,t,r){var n=this.set,a=e.length,o=n.sampleRate,i=8==n.bitRate?8:16,s=a*(i/8),f=new ArrayBuffer(44+s),c=new DataView(f),u=0,l=function(e){for(var t=0;t<e.length;t++,u++)c.setUint8(u,e.charCodeAt(t))},v=function(e){c.setUint16(u,e,!0),u+=2},p=function(e){c.setUint32(u,e,!0),u+=4};if(l("RIFF"),p(36+s),l("WAVE"),l("fmt "),p(16),v(1),v(1),p(o),p(o*(i/8)),v(i/8),v(i),l("data"),p(s),8==i)for(var h=0;h<a;h++,u++){var g=128+(e[h]>>8);c.setInt8(u,g,!0)}else for(h=0;h<a;h++,u+=2)c.setInt16(u,e[h],!0);t(new Blob([c.buffer],{type:"audio/wav"}))}}();