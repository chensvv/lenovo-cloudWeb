<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">
    <title>联想语音开放平台</title>
    <link href="../framework/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../framework/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="css/login.css" rel="stylesheet"/>
    <script type="text/javascript" src="../framework/jquery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../framework/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/login.js"></script>
    <script src="../common/js/jquery.base64.js"></script>
    <script src="../common/mixjs/commurl.js"></script>
    <style>
    
        .con{
            display:none;
        }
        .active{
            position: relative;
        }
        .active::before{
            content: "";
            position: absolute;
            top: 0;
            left: 100%;
            width: 0;
            height: 100%;
            border-bottom: 3px solid #333;
        }
        .active::before {
            width: 15px;
            left: 50%;
            top: 5px;
            transform: translateX(-50%);
        }
        .btn-title{
            padding: 40px 0;
            text-align: center;
            font-size: 20px;
        }
        .spanList{
            display: inline-block;
            width: 100px;
            cursor: pointer;
        }
        .context{
            padding: 10px 50px;
        }
        .con input{
            width: 100%;
            height: 50px;
            border: 1px solid #d6d6d6;
            border-radius: 5px;
            font-size: 20px;
            padding-left: 15px;
            outline: none;
        }
        .username{
            padding-bottom: 30px;
        }
        input::-webkit-input-placeholder {
            /* placeholder颜色  */
            color: #cdcdcd;
            /* placeholder字体大小  */
            font-size: 16px;
        }
        .forget{
            padding-top: 10px;
            text-align: right;
            color: #bababa;
        }
        .forget span{
            padding-right: 10px;
            cursor: pointer;
        }
        .login-btn,.reg-btn{
            width: 100%;
            height: 50px;
            border: none;
            background: linear-gradient(to right, #25ace8, #80e5e7);
            color: #fff;
            font-size: 16px;
            letter-spacing: 2px;
            outline: none;
        }
        .login-btn-box{
            padding: 50px 0;
        }
        .reg-btn-box{
            padding-top: 10px;
        }
        .reg-input .reg-input-box{
            padding-bottom: 30px;
            position: relative;
        }
        .login-input-box{
            position: relative;
        }
        .err-text{
            padding-left: 5px;
            font-size: 12px;
            color: red;
            position: absolute;
            top: 53px;
            left: 0;
        }
        .code{
            width: 100%;
            height: 50px;
            border: 1px solid #d6d6d6;
            border-radius: 5px;
        }
        .code .code-input{
            border: transparent;
            width: 68%;
            height: 99%;
        }
        .code .code-btn{
            width: 30%;
            text-align: center;
            color: #298dad;
            cursor: pointer;
            border: none;
            background: none;
            outline: none;
        }
    </style>
</head>
<body>
    <div class="user-box">
        <div class="logo">

        </div>
                    <div class="user-login">
                            <div class="main">
                                    <div class="btn-title">
                                        <span class="active spanList" id="loginList">登录</span>
                                        <span class="spanList" id="regList">注册</span>
                                    </div>
                                   <div class="context">
                                        <div class="con login-input" id="loginInput">
                                            <div class="username login-input-box">
                                                <input type="text" id="loginPhone" placeholder="邮箱/手机号" onblur="isLoginP()">
                                                <span id="errloginP" class="err-text"></span>
                                            </div>
                                            <div class="password login-input-box">
                                                <input type="password" id="loginPassword" placeholder="密码" onblur="isLoginW()">
                                                <span id="errloginW" class="err-text"></span>
                                            </div>
                                            <!-- <div class="forget"><span>忘记密码</span></div> -->
                                            <div class="login-btn-box">
                                                <button class="login-btn" id="loginBtn">登录</button>
                                            </div>
                                        </div>
                                        <div class="con reg-input" id="regInput">
                                            <div class="reg-input-box">
                                                <input type="text" id="regPhone" placeholder="邮箱/手机号" onblur="isPhoneNum()">
                                                <span id="errPhone" class="err-text"></span>
                                            </div>
                                            <!-- <div class="reg-input-box">
                                                <div class="code">
                                                    <input type="text" id="code" placeholder="验证码" class="code-input">
                                                    <button class="code-btn" id="secode">发送验证码</button>
                                                </div>
                                                <span id="errCode" class="err-text"></span>
                                            </div> -->
                                            <div class="reg-input-box">
                                                <input type="password" id="regPassword" placeholder="设置密码" onblur="isPassword()">
                                                <span id="errPassword" class="err-text"></span>
                                            </div>
                                            <div class="reg-input-box">
                                                <input type="password" id="regPasswordConfirm" placeholder="确认密码" onblur="confirmPass()">
                                                <span id="errConPass" class="err-text"></span>
                                            </div>
                                            <div class="reg-btn-box">
                                                <button class="reg-btn" id="regBtn">注册</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                    </div>
    </div>

</body>
<script>
    var countdown = 60;
    var loginInput = document.getElementById('loginInput')
    var regInput = document.getElementById('regInput')
    // 标签页切换
$(".con").eq(0).show();
$(".btn-title span").click(function(){
    var num =$(".btn-title span").index(this);
    $(".con").hide();
    $(".con").eq(num).show();
    $(this).attr("class","active spanList");
    $(this).siblings().attr("class","spanList");
    if(getStyle(loginInput, 'display') == 'none'){
        $('#loginPhone').val('')
        $('#errloginP').text('')
        $('#loginPassword').val('')
        $('#errloginW').text('')
    }
    if(getStyle(regInput, 'display') == 'none'){
        $('#regPhone').val('')
        $('#errPhone').text('')
        $('#regPassword').val('')
        $('#errPassword').text('')
        $('#regPasswordConfirm').val('')
        $('#errConPass').text('')
    }
})
// 发送验证码
$("#secode").click(function (){
    sendCode($("#secode"));
});
function sendCode(obj){
    var phone = $("#regPhone").val();
    var result = isPhoneNum();
    if(result) {
        // $.ajax({
        //     url:"http://localhost:8085/my/sendYzm",
        //     data:{phone:phone},
        //     dataType:"json",
        //     type:"post",
        //     async : false,
        //     cache : false,
        //     success:function(res){
        //         debugger;
        //         if(res){
        //             alert("验证码发送成功");
        //         }else{

        //         }
        //     },
        //     error:function(){
        //         alert("验证码发送失败");
        //     }
        // })
        setTime(obj);//开始倒计时
    }
}
// 倒计时
function setTime(obj) {
    if (countdown == 0) {
        obj.prop('disabled', false);
        obj.text("点击获取验证码");
        countdown = 60;//60秒过后button上的文字初始化,计时器初始化;
        return;
    } else {
        obj.prop('disabled', true);
        obj.text("("+countdown+"s)后重新发送") ;
        countdown--;
    }
    setTimeout(function() { 
        setTime(obj) 
    },1000) //每1000毫秒执行一次
}
// 注册手机号邮箱验证
function isPhoneNum(){
    var phonenum = $("#regPhone").val()
    var phoneReg = /^1[0-9]{10}$/
    var mailReg = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/
    if(phonenum == ''){
        $('#errPhone').text('请输入手机号码或邮箱')
    }else if(phoneReg.test(phonenum) || mailReg.test(phonenum)){
        $('#errPhone').text('')
        return true;
    }else{
        $('#errPhone').text('请输入正确的手机号码或邮箱')
        return false;
    }
}
// 注册密码验证
function isPassword(){
    var passCode = $("#regPassword").val()
    var passwordReg = /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9]).{8,}$/
    if(passCode == ''){
        $('#errPassword').text('请输入密码')
    }else if(passwordReg.test(passCode)){
        $('#errPassword').text('')
        return true;
    }else{
        $('#errPassword').text('密码长度必须大于8个字符，包含数字、字母、特殊符号')
        return false;
    }
}
// 注册确认密码
function confirmPass(){
    var conPassCode = $("#regPasswordConfirm").val()
    if($("#regPassword").val() == conPassCode){
        $('#errConPass').text('')
        return true
    }else{
        $('#errConPass').text('两次密码输入不一致')
        return false
    }
}
function isLoginP(){
    if($("#loginPhone").val() !=''){
        $('#errloginP').text('')
    }
}
function isLoginW(){
    if($('#loginPassword').val() !=''){
        $('#errloginW').text('')
    }
}
$('#loginBtn').click(function(){
    var username = $("#loginPhone").val()
    var password = $.base64.encode($('#loginPassword').val())
    if(username == ''){
        $('#errloginP').text('请输入手机号码或邮箱')
    }else if(password == ''){
        $('#errloginW').text('请输入密码')
    }else{
        $.ajax({
            url:urlhead+'/lasf/web/login',
            type:'post',
            dataType:'json',
            data:{u:username,p:password},
            success:function(res){
                if(res.status == 0){
                    window.localStorage.setItem('acd',$.base64.encode(res.lenovoId))
                    window.localStorage.setItem('lk',$.base64.encode(res.lenovoKey))
                    window.localStorage.setItem('sk',$.base64.encode(res.secretKey))
                    window.localStorage.setItem('un',res.userName)
                    window.localStorage.setItem('token',res.token)
                    window.location.href = '../welcome/index.html'
                }else{
                    $('#errloginW').text(res.description)
                }
            },
            error:function(err){

            }
        })
    }
})
$('#regBtn').click(function(){
    var resPhone = isPhoneNum()
    var resPassword = isPassword()
    var resConpass = confirmPass()
    var regUsername = $("#regPhone").val()
    var regPassword = $.base64.encode($("#regPassword").val())
    if(resPhone && resPassword && resConpass){
        $.ajax({
            url:urlhead+'/lasf/web/register',
            type:'post',
            dataType:'json',
            data:{u:regUsername,p:regPassword},
            success:function(res){
                if(res.status == 0){
                    $('#regBtn').text('注册成功，请登录')
                    setTimeout(()=>{
                        $('#loginList').addClass('active')
                        $('#regList').removeClass('active')
                        $('#loginInput').css('display','block')
                        $('#regInput').css('display','none')
                    },1000)
                }else{
                    $('#errPhone').text(res.error)
                }
            },
            error:function(err){

            }
        })
    }else{
        return false
    }
})
// 获取标签style
function getStyle(obj, attr) {
    return obj.currentStyle ? obj.currentStyle[attr] : getComputedStyle(obj, false)[attr];
}
</script>
</html>