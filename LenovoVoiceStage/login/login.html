<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">
    <title>联想语音开放平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"  />
    <meta http-equiv="Imagetoolbar" content="no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="icon" href="../common/images/favicon.ico" type="image/x-icon" />
    <link href="../framework/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../framework/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="css/login.css" rel="stylesheet"/>
    <link rel="stylesheet" href="./css/step.css">
    <script type="text/javascript" src="../framework/jquery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../framework/bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/login.js"></script>
    <script src="../common/js/jquery.base64.js"></script>
    <script src="../common/mixjs/commurl.js"></script>
    <!-- <script src="./js/step.js"></script> -->
    <style>
    
    </style>
</head>
<body>
    <div class="user-box" id="user-box">
            <div class='navbar-icon'>
                <img src='../common/images/logo_img.png'><img src='../common/images/logo_text.png' class='logo_text'>
            </div>
                    <div class="user-login">
                            <div class="main">
                                    <div class="btn-title">
                                        <span class="active spanList" id="loginList">登录</span>
                                        <span class="spanList" id="regList">注册</span>
                                    </div>
                                   <div class="context">
                                        <div class="con login-input" id="loginInput">
                                            <div class="username login-input-box">
                                                <input type="text" id="loginPhone" placeholder="邮箱/手机号" onblur="isLoginP()">
                                                <span id="errloginP" class="err-text"></span>
                                            </div>
                                            <div class="password login-input-box">
                                                <input type="password" id="loginPassword" placeholder="密码" onblur="isLoginW()">
                                                <span id="errloginW" class="err-text"></span>
                                            </div>
                                            <!-- <div class="forget"><span>忘记密码</span></div> -->
                                            <div class="login-btn-box">
                                                <button class="login-btn" id="loginBtn">登录</button>
                                                <span class="hint-msg">推荐使用联想账号登录</span>
                                            </div>
                                        </div>
                                        <div class="con reg-input" id="regInput">
                                                    <div class="pageCont">
                                                        <div id="page1" class="stepPage">
                                                            <div class="reg-input-box">
                                                                <input type="email" id="regMail" placeholder="请输入邮箱" onblur="isMail()">
                                                                <span id="errMail" class="err-text"></span>
                                                            </div>
                                                            <div class="reg-input-box">
                                                                <input type="phone" id="regPhone" placeholder="请输入手机号" onblur="isPhoneNum()">
                                                                <span id="errPhone" class="err-text"></span>
                                                            </div>
                                                            <div class="reg-input-box">
                                                                <input type="text" id="regName" placeholder="请输入姓名" onblur="isName()">
                                                                <span id="errName" class="err-text"></span>
                                                            </div>
                                                            <div class="reg-input-box">
                                                                <input type="text" id="regPany" placeholder="请输入公司名称" onkeyup="showTion()" onblur="isPany()">
                                                                <span id="errPany" class="err-text"></span>
                                                            </div>
                                                            <div class="reg-input-box" id="tionShow">
                                                                <input type="text" id="regTion" placeholder="请输入部门名称" onblur="isTion()">
                                                                <span id="errTion" class="err-text"></span>
                                                            </div>
                                                            <div class="reg-btn-box">
                                                                <button class="reg-btn" id="nextBtn">下一步</button>
                                                            </div>
                                                        </div>
                                                        <div id="page2" class="stepPage">
                                                            <div class="reg-input-box">
                                                                <input type="password" id="regPassword" placeholder="设置密码" onblur="isPassword()">
                                                                <span id="errPassword" class="err-text"></span>
                                                            </div>
                                                            <div class="reg-input-box">
                                                                <input type="password" id="regPasswordConfirm" placeholder="确认密码" onblur="confirmPass()">
                                                                <span id="errConPass" class="err-text"></span>
                                                            </div>
                                                            <div class="reg-btn-box">
                                                                <button class="reg-btn first-btn" id="firstBtn">上一步</button>
                                                                <button class="reg-btn reg-btn_btn" id="regBtn">注册</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                            <!-- <div class="reg-input-box">
                                                <input type="text" id="regPhone" placeholder="邮箱/手机号" onblur="isPhoneNum()">
                                                <span id="errPhone" class="err-text"></span>
                                            </div> -->
                                            <!-- <div class="reg-input-box">
                                                <div class="code">
                                                    <input type="text" id="code" placeholder="验证码" class="code-input">
                                                    <button class="code-btn" id="secode">发送验证码</button>
                                                </div>
                                                <span id="errCode" class="err-text"></span>
                                            </div> -->
                                            <!-- <div class="reg-input-box">
                                                <input type="password" id="regPassword" placeholder="设置密码" onblur="isPassword()">
                                                <span id="errPassword" class="err-text"></span>
                                            </div>
                                            <div class="reg-input-box">
                                                <input type="password" id="regPasswordConfirm" placeholder="确认密码" onblur="confirmPass()">
                                                <span id="errConPass" class="err-text"></span>
                                            </div>
                                            <div class="reg-btn-box">
                                                <button class="reg-btn" id="regBtn">注册</button>
                                            </div> -->
                                        </div>
                                    </div>
                                </div>
                    </div>
    </div>

</body>
<script>
    var countdown = 60;
    var loginInput = document.getElementById('loginInput')
    var regInput = document.getElementById('regInput')
    var tionInput = document.getElementById('tionShow')
    var user = navigator.userAgent.match(/(iPhone|iPod|Android|ios)/i)
    // 标签页切换
$(".con").eq(0).show();
$('#prevBtn').css('display','none')
$('#tionShow').css('display','none')
$('#page2').css('display','none')
$(".btn-title span").click(function(){
    var num =$(".btn-title span").index(this);
    $(".con").hide();
    $(".con").eq(num).show();
    $(this).attr("class","active spanList");
    $(this).siblings().attr("class","spanList");
    if(getStyle(loginInput, 'display') == 'none'){
        $('#loginPhone').val('')
        $('#errloginP').text('')
        $('#loginPassword').val('')
        $('#errloginW').text('')
        $('.user-login').addClass('reg-main')
        if(user){
            $('.user-login').addClass('muser-login')
        }
    }
    if(getStyle(regInput, 'display') == 'none'){
        $('#regPhone').val('')
        $('#errPhone').text('')
        $('#regMail').val('')
        $('#errMail').text('')
        $('#regName').val('')
        $('#errName').text('')
        $('#regPany').val('')
        $('#errPany').text('')
        $('#regTion').val('')
        $('#errTion').text('')
        $('#regPassword').val('')
        $('#errPassword').text('')
        $('#userMsg').val('')
        $('#errUserMsg').text('')
        $('#regPasswordConfirm').val('')
        $('#errConPass').text('')
        $('.user-login').removeClass('reg-main')
        $('#page1').css('display','block')
        $('#page2').css('display','none')
    }
})
$('#firstBtn').click(function(){
    $('#page1').css('display','block')
    $('#page2').css('display','none')
})
$('#nextBtn').click(function(){
    var resPhone = isPhoneNum()
    var resMail = isMail()
    var resName = isName()
    var resPany = isPany()
    var resTion = isTion()
    if(getStyle(tionInput, 'display') == 'none'){
        if(resPhone && resMail && resName && resPany){
            $('#page1').css('display','none')
            $('#page2').css('display','block')
        }else{
            return false
        }
    }else{
        if(resPhone && resMail && resName && resPany && resTion){
            $('#page1').css('display','none')
            $('#page2').css('display','block')
        }else{
            return false
        }
    }
    
    

})
// 发送验证码
$("#secode").click(function (){
    sendCode($("#secode"));
});
function sendCode(obj){
    var phone = $("#regPhone").val();
    var result = isPhoneNum();
    if(result) {
        // $.ajax({
        //     url:"http://localhost:8085/my/sendYzm",
        //     data:{phone:phone},
        //     dataType:"json",
        //     type:"post",
        //     async : false,
        //     cache : false,
        //     success:function(res){
        //         debugger;
        //         if(res){
        //             alert("验证码发送成功");
        //         }else{

        //         }
        //     },
        //     error:function(){
        //         alert("验证码发送失败");
        //     }
        // })
        setTime(obj);//开始倒计时
    }
}
// 倒计时
function setTime(obj) {
    if (countdown == 0) {
        obj.prop('disabled', false);
        obj.text("点击获取验证码");
        countdown = 60;//60秒过后button上的文字初始化,计时器初始化;
        return;
    } else {
        obj.prop('disabled', true);
        obj.text("("+countdown+"s)后重新发送") ;
        countdown--;
    }
    setTimeout(function() { 
        setTime(obj) 
    },1000) //每1000毫秒执行一次
}
// 注册手机号邮箱验证
function isPhoneNum(){
    var phonenum = $("#regPhone").val()
    var phoneReg = /^1[0-9]{10}$/
    
    if(phonenum == ''){
        $('#errPhone').text('请输入手机号码')
        return false
    }else if(!phoneReg.test(phonenum)){
        $('#errPhone').text('请输入正确格式的手机号码')
        return false;
    }else{
        $('#errPhone').text('')
        return true;
    }
}
function isMail(){
    var mailVal = $('#regMail').val()
    var mailReg = /^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/
    if(mailVal == ''){
        $('#errMail').text('请输入邮箱')
        return false
    }else if(!mailReg.test(mailVal)){
        $('#errMail').text('请输入正确格式的邮箱')
        return false
    }else{
        $('#errMail').text('')
        return true;
    }
}

function isName(){
    var nameVal = $('#regName').val()
    var nameReg = /^\S+$/;
    if(nameVal == ''){
        $('#errName').text('请输入姓名')
        return false
    }else if(!nameReg.test(nameVal)){
        $('#errName').text('姓名不能包含空格')
        return false
    }else{
        $('#errName').text('')
        return true
    }
}
function isPany(){
    var panyVal = $('#regPany').val()
    var panyReg = /^\S+$/;
    if(panyVal == ''){
        $('#errPany').text('请输入公司名称')
        return false
    }else if(!panyReg.test(panyVal)){
        $('#errPany').text('公司名称不能包含空格')
        return false
    }else{
        $('#errPany').text('')
        return true
    }
}
function isTion(){
    var tionVal = $('#regTion').val()
    var tionReg = /^\S+$/;
    if(getStyle(tionInput, 'display') == 'block'){
        if(tionVal == ''){
            $('#errTion').text('请输入部门名称')
            return false
        }else if(!tionReg.test(tionVal)){
            $('#errTion').text('部门名称不能包含空格')
            return false
        }else{
            $('#errTion').text('')
            return true
        }
    }else{
        $('#errTion').text('')
    }
    
}
function showTion(){
    var panyVal = $('#regPany').val()
    if(panyVal.indexOf('联想') != -1){
        $('#tionShow').css('display','block')
    }else{
        $('#tionShow').css('display','none')
        $('#errTion').text('')
    }
}
// 注册密码验证
function isPassword(){
    var passCode = $("#regPassword").val()
    var passwordReg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z~.'!@#￥$%^&*()+-_=:]{8,}$/
    if(passCode == ''){
        $('#errPassword').text('请输入密码')
    }else if(passwordReg.test(passCode)){
        $('#errPassword').text('')
        return true;
    }else{
        $('#errPassword').text('密码长度必须包含数字、字母且大于8个字符')
        return false;
    }
}
// 注册确认密码
function confirmPass(){
    var conPassCode = $("#regPasswordConfirm").val()
    if($("#regPassword").val() == conPassCode){
        $('#errConPass').text('')
        return true
    }else{
        $('#errConPass').text('两次密码输入不一致')
        return false
    }
}
function isLoginP(){
    if($("#loginPhone").val() !=''){
        $('#errloginP').text('')
    }
}
function isLoginW(){
    if($('#loginPassword').val() !=''){
        $('#errloginW').text('')
    }
}
// function getQueryVariable(variable){
//        var query = window.location.search.substring(1);
//        var vars = query.split("&");
//        for (var i=0;i<vars.length;i++) {
//                var pair = vars[i].split("=");
//                if(pair[0] == variable){return pair[1];}
//        }
//        return(false);
// }
$('#loginBtn').click(function(){
    var username = $("#loginPhone").val()
    var password = $.base64.encode($('#loginPassword').val())
    if(username == ''){
        $('#errloginP').text('请输入手机号码或邮箱')
    }else if(password == ''){
        $('#errloginW').text('请输入密码')
    }else{
        $.ajax({
            url:urlhead+'/lasf/web/login',
            type:'post',
            dataType:'json',
            data:{u:username,p:password},
            success:function(res){
                if(res.status == 0){
                    window.localStorage.setItem('acd',$.base64.encode(res.lenovoId))
                    window.localStorage.setItem('lk',$.base64.encode(res.lenovoKey))
                    window.localStorage.setItem('sk',$.base64.encode(res.secretKey))
                    window.localStorage.setItem('un',res.userName)
                    window.localStorage.setItem('token',res.token)
                    if(window.localStorage.getItem('returnurl') == ''){
                        window.location.href = '../welcome/index.html'
                    }else{
                        window.location.href = window.localStorage.getItem('returnurl')
                    }
                    
                }else{
                    $('#errloginW').text(res.description)
                }
            },
            error:function(err){

            }
        })
    }
})
$('#regBtn').click(function(){
    var resPassword = isPassword()
    var resConpass = confirmPass()
    var regUserPhone = $("#regPhone").val()
    var regPassword = $.base64.encode($("#regPassword").val())
    var regUserMail = $("#regMail").val()
    var regUserName = $("#regName").val()
    var regUserPany = $("#regPany").val()
    var regUserTion = $("#regTion").val()
    if(resPassword && resConpass){
        $.ajax({
            url:urlhead+'/lasf/web/register',
            type:'post',
            dataType:'json',
            data:{u:regUserPhone,p:regPassword},
            success:function(res){
                if(res.status == 0){
                    $('#errConPass').text('注册成功，请登录')
                    setTimeout(()=>{
                        $('#loginList').addClass('active')
                        $('#regList').removeClass('active')
                        $('#loginInput').css('display','block')
                        $('#regInput').css('display','none')
                        $('#regPhone').val('')
                        $('#errPhone').text('')
                        $('#regMail').val('')
                        $('#errMail').text('')
                        $('#regName').val('')
                        $('#errName').text('')
                        $('#regPany').val('')
                        $('#errPany').text('')
                        $('#regTion').val('')
                        $('#errTion').text('')
                        $('#regPassword').val('')
                        $('#errPassword').text('')
                        $('#userMsg').val('')
                        $('#errUserMsg').text('')
                        $('#regPasswordConfirm').val('')
                        $('#errConPass').text('')
                        $('#page1').css('display','block')
                        $('#page2').css('display','none')
                    },1000)
                }else{
                    $('#errConPass').text(res.error)
                }
            },
            error:function(err){

            }
        })
    }else{
        return false
    }
})
// 获取标签style
function getStyle(obj, attr) {
    return obj.currentStyle ? obj.currentStyle[attr] : getComputedStyle(obj, false)[attr];
}
</script>
</html>