<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">
    <title>联想语音开放平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"  />
    <meta http-equiv="Imagetoolbar" content="no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link href="../framework/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../framework/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="css/setpwd.css" rel="stylesheet"/>
    <script type="text/javascript" src="../framework/jquery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../framework/bootstrap/js/bootstrap.min.js"></script>
    <script src="../common/js/jquery.base64.js"></script>
    <script src="../common/mixjs/commurl.js"></script>
    <style>
        
    </style>
</head>
<body>
    <div class="user-box">
        <div class='navbar-icon'>
            <img src='../common/images/logo_img.png'><img src='../common/images/logo_text.png' class='logo_text'>
        </div>
        <div class="user-login">
            <div class="back" onclick="goBack()"></div>
            <div class="main">
                <span class="main-title">重置密码</span>
                <div class="main-upd-box">
                    <div class="main-input">
                        <div class="main-input-box">
                            <span class="input-label">请输入新密码</span>
                            <input type="password" id="password" onblur="isPassword()">
                            <span id="errPass" class="err-text"></span>
                        </div>
                        <div class="main-input-box">
                            <span class="input-label">再次输入</span>
                            <input type="password" id="conPassword" onblur="confirmPass()">
                            <span id="errCon" class="err-text"></span>
                        </div>
                    </div>
                    <div class="main-btn">
                        <button class="con-btn" id="conBtn">确认</button>
                    </div>
                </div>
                <div class="main-hint">
                    <img src="./image/suc.png" alt="">
                    <span class="hint-txt">密码修改成功，请重新登录(<span id="timer">2</span>s)</span>
                </div>
            </div>
        </div>
    </div>

</body>
<script>
// 注册密码验证
function isPassword(){
    var passCode = $("#password").val()
    var passwordReg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z~.'!@#￥$%^&*()+-_=:]{8,}$/
    if(passCode == ''){
        $('#errPass').text('请输入密码')
    }else if(passwordReg.test(passCode)){
        $('#errPass').text('')
        return true;
    }else{
        $('#errPass').text('密码长度必须包含数字、字母且大于8个字符')
        return false;
    }
}
// 注册确认密码
function confirmPass(){
    var conPassCode = $("#conPassword").val()
    if($("#password").val() == conPassCode){
        $('#errCon').text('')
        return true
    }else{
        $('#errCon').text('两次密码输入不一致')
        return false
    }
}
$('#conBtn').click(function(){
    var updPass = isPassword()
    var updConpass = confirmPass()
    var updPassWord = $.base64.encode($("#password").val())
    if(updPass && updConpass){
        $.ajax({
            url:urlhead+'/lasf/web/setpwd',
            type:'post',
            dataType:'json',
            data:{
                lid:$.base64.decode(window.localStorage.getItem('acd')),
                t:window.localStorage.getItem('token'),
                pwd:updPassWord
            },
            success:function(res){
                if(res.status == 0){
                    $('.main-upd-box').css('display','none')
                    $('.main-hint').css('display','block')
                    window.setInterval("run();", 1000);
                }else{
                    $('#errCon').text(res.error)
                }
            },
            error:function(err){

            }
        })
    }else{
        return false
    }
})


function run(){
    var s = document.getElementById("timer");
    if(s.innerHTML == 1){
        window.location.href='./login.html';
        return false;
    }
    s.innerHTML = s.innerHTML * 1 - 1;
}
function goBack(){
    window.history.go(-1)
}
</script>
</html>