<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">
    <title>联想语音开放平台</title>
    <link href="../framework/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../framework/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="css/setpwd.css" rel="stylesheet"/>
    <script type="text/javascript" src="../framework/jquery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../framework/bootstrap/js/bootstrap.min.js"></script>
    <script src="../common/js/jquery.base64.js"></script>
    <script src="../common/mixjs/commurl.js"></script>
    <style>
        .main{
            width: 100%;
        }
        .main-title{
            display: block;
            width: 100%;
            text-align: center;
            border-bottom: 2px solid #d3d3d3;
            font-size: 32px;
            padding: 40px 0 20px;
            letter-spacing: 5px;
        }
        .main-input{
            width: 100%;
            padding: 30px 30px 0;
        }
        .main-input-box{
            padding-bottom: 30px;
            position: relative;
        }
        .input-label{
            display: block;
            padding-bottom: 8px;
            color: #5e5e5e;
            font-size: 14px;
        }
        .main-input-box input{
            width: 100%;
            height: 50px;
            border: 1px solid #d6d6d6;
            border-radius: 5px;
            font-size: 20px;
            padding-left: 15px;
            outline: none;
        }
        .main-btn{
            padding: 0 30px;
        }
        .con-btn{
            width: 100%;
            height: 50px;
            border: none;
            background: linear-gradient(to right, #25ace8, #80e5e7);
            color: #fff;
            font-size: 16px;
            letter-spacing: 2px;
            outline: none;
        }
        .err-text{
            padding-left: 5px;
            font-size: 12px;
            color: red;
            position: absolute;
            top: 83px;
            left: 0;
        }
        .main-hint{
            text-align: center;
            padding: 50px 0;
            display: none;
        }
        .main-hint img{
            width: 40px;
            height: 40px;
            display: block;
            margin: 0 auto;
        }
        .main-hint .hint-txt{
            padding-top: 20px;
            display: inline-block;
            font-size: 20px;
        }
    </style>
</head>
<body>
    <div class="user-box">
        <div class="logo">

        </div>
        <div class="user-login">
            <div class="main">
                <span class="main-title">重置密码</span>
                <div class="main-upd-box">
                    <div class="main-input">
                        <div class="main-input-box">
                            <span class="input-label">请输入新密码</span>
                            <input type="password" id="password" onblur="isPassword()">
                            <span id="errPass" class="err-text"></span>
                        </div>
                        <div class="main-input-box">
                            <span class="input-label">再次输入</span>
                            <input type="password" id="conPassword" onblur="confirmPass()">
                            <span id="errCon" class="err-text"></span>
                        </div>
                    </div>
                    <div class="main-btn">
                        <button class="con-btn" id="conBtn">确认</button>
                    </div>
                </div>
                <div class="main-hint">
                    <img src="./image/suc.png" alt="">
                    <span class="hint-txt">密码修改成功，请重新登录(<span id="timer">2</span>s)</span>
                </div>
            </div>
        </div>
    </div>

</body>
<script>
// 注册密码验证
function isPassword(){
    var passCode = $("#password").val()
    var passwordReg = /^(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9]).{8,}$/
    if(passCode == ''){
        $('#errPass').text('请输入密码')
    }else if(passwordReg.test(passCode)){
        $('#errPass').text('')
        return true;
    }else{
        $('#errPass').text('密码长度必须大于8个字符，包含数字、字母、特殊符号')
        return false;
    }
}
// 注册确认密码
function confirmPass(){
    var conPassCode = $("#conPassword").val()
    if($("#password").val() == conPassCode){
        $('#errCon').text('')
        return true
    }else{
        $('#errCon').text('两次密码输入不一致')
        return false
    }
}
$('#conBtn').click(function(){
    var updPass = isPassword()
    var updConpass = confirmPass()
    var updPassWord = $.base64.encode($("#password").val())
    if(updPass && updConpass){
        $.ajax({
            url:urlhead+'/lasf/web/setpwd',
            type:'post',
            dataType:'json',
            data:{
                lid:$.base64.decode(window.localStorage.getItem('acd')),
                t:window.localStorage.getItem('token'),
                pwd:updPassWord
            },
            success:function(res){
                if(res.status == 0){
                    $('.main-upd-box').css('display','none')
                    $('.main-hint').css('display','block')
                    window.setInterval("run();", 1000);
                }else{
                    $('#errCon').text(res.error)
                }
            },
            error:function(err){

            }
        })
    }else{
        return false
    }
})


function run(){
    var s = document.getElementById("timer");
    if(s.innerHTML == 1){
        window.location.href='./login.html';
        return false;
    }
    s.innerHTML = s.innerHTML * 1 - 1;
}

</script>
</html>