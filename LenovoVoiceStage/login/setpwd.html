<!DOCTYPE html>
<html lang="zh_CN">
<head>
    <meta charset="UTF-8">
    <title i18n="i18n.title">联想语音开放平台</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"  />
    <meta http-equiv="Imagetoolbar" content="no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link href="../framework/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="../framework/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="../common/css/head.css">
    <link href="css/setpwd.css" rel="stylesheet"/>
    <script type="text/javascript" src="../framework/jquery/jquery-3.2.1.min.js"></script>
    <script type="text/javascript" src="../framework/bootstrap/js/bootstrap.min.js"></script>
    <script src="../common/js/jquery.base64.js"></script>
    <script src="../common/js/jquery.i18n.js"></script>
    <script src="../common/mixjs/commurl.js"></script>
    <script src="../common/js/com.js"></script>
    <style>
        
    </style>
</head>
<body>
    <div class="user-box">
        <div class='navbar-icon2'>
            <div class="logo-box">
                <img src='../common/images/logo_img.png'>
                <span class='logo_text' i18n="i18n.writ">联想语音</span>
            </div>
            <div class="drop-down">
                <div id="box">
                    <div id="b-m" class="b-m">
                        <img src="../common/images/china.png" class="opimg" id="op-img">
                        <span class="optxt" id="op-txt">简体中文</span>
                    </div>
                    <div class="tri-down"></div>
                </div>
                <div id="down">
                    <ul class="phones">
                        <li><img src="../common/images/china.png" class="opimg" id="op-img"> <span class="optxt">简体中文</span></li>
                        <li><img src="../common/images/usa.png" class="opimg" id="op-img"> <span class="optxt">English</span></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="user-login">
            <div class="back" onclick="goBack()"></div>
            <div class="main">
                <span class="main-title" i18n="i18n.respass">重置密码</span>
                <div class="main-upd-box">
                    <div class="main-input">
                        <div class="main-input-box">
                            <span class="input-label" i18n="i18n.newpass">请输入新密码</span>
                            <input type="password" id="password" onblur="isPassword()" oninput="passInput()">
                            <span id="errPasswordNull" class="err-text"i18n="i18n.errPasswordNull">请输入密码</span>
                            <span id="errPasswordR" class="err-text" i18n="i18n.errPasswordR">密码长度必须包含数字、字母且大于8个字符</span>
                        </div>
                        <div class="main-input-box">
                            <span class="input-label" i18n="i18n.enteragain">再次输入</span>
                            <input type="password" id="conPassword" onblur="confirmPass()">
                            <span id="errCon" class="err-text" i18n="i18n.twopass">两次密码输入不一致</span>
                        </div>
                    </div>
                    <div class="main-btn">
                        <button class="con-btn" id="conBtn" i18n="i18n.confirm">确认</button>
                    </div>
                </div>
                <div class="main-hint">
                    <img src="./image/suc.png" alt="">
                    <span class="hint-txt">密码修改成功，请重新登录(<span id="timer">2</span>s)</span>
                </div>
            </div>
        </div>
    </div>

</body>
<script>
function passInput(){
    if($("#regPassword").val() !=''){
        $('#errPasswordNull').css('display','none')
    }
}
// 注册密码验证
function isPassword(){
    var passCode = $("#password").val()
    var passwordReg = /^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z~.'!@#￥$%^&*()+-_=:]{8,}$/
    if(passCode == ''){
        $('#errPasswordNull').css('display','block')
        $('#errPasswordR').css('display','none')
    }else if(passwordReg.test(passCode)){
        $('#errPasswordNull').css('display','none')
        $('#errPasswordR').css('display','none')
        return true;
    }else{
        $('#errPasswordR').css('display','block')
        return false;
    }
}
// 注册确认密码
function confirmPass(){
    var conPassCode = $("#conPassword").val()
    if($("#password").val() == conPassCode){
        $('#errCon').css('display','none')
        return true
    }else{
        $('#errCon').css('display','block')
        return false
    }
}
$('#conBtn').click(function(){
    var updPass = isPassword()
    var updConpass = confirmPass()
    var updPassWord = $.base64.encode($("#password").val())
    if(updPass && updConpass){
        $.ajax({
            url:urlhead+'/web/setpwd',
            type:'post',
            dataType:'json',
            data:{
                lid:$.base64.decode(window.localStorage.getItem('acd')),
                t:window.localStorage.getItem('token'),
                pwd:updPassWord
            },
            success:function(res){
                if(res.status == 0){
                    window.localStorage.clear()
                    $('.main-upd-box').css('display','none')
                    $('.main-hint').css('display','block')
                    window.setInterval("run();", 1000);
                }else{
                    $('#errCon').text(res.error)
                }
            },
            error:function(err){

            }
        })
    }else{
        return false
    }
})


function run(){
    var s = document.getElementById("timer");
    if(s.innerHTML == 1){
        window.location.href='./login.html';
        return false;
    }
    s.innerHTML = s.innerHTML * 1 - 1;
}
function goBack(){
    window.history.go(-1)
}
</script>
</html>